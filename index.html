<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>éšæœºæŠ½ç­¾å™¨</title>
<meta name="description" content="ç®€å•å¥½ç”¨çš„éšæœºæŠ½ç­¾ç½‘é¡µï¼ˆç®—æ³•ç»„/è½¯ä»¶ç»„/åµŒå…¥å¼ç»„/å®£ä¼ éƒ¨/ç»„ç»‡éƒ¨ï¼‰" />
<style>
  :root{
    --bg1:#07143a; --bg2:#0f2a5a; --accent:#ffd166; --card:#0b2545;
    --glass: rgba(255,255,255,0.04);
    font-family: "Segoe UI", "Microsoft YaHei", system-ui, -apple-system, "Helvetica Neue", Arial;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0}
  body{
    background: radial-gradient(600px 300px at 10% 10%, rgba(147,51,234,0.12), transparent),
                linear-gradient(180deg,var(--bg1),var(--bg2));
    color:#eaf2ff; display:flex; align-items:center; justify-content:center; padding:24px;
  }
  .app{
    width:min(980px,96%); background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:14px; padding:20px; box-shadow: 0 12px 40px rgba(2,6,23,0.6);
    display:grid; grid-template-columns: 1fr 300px; gap:18px; align-items:start;
  }

  .left{padding:18px; border-radius:10px; background:linear-gradient(180deg,var(--glass),rgba(255,255,255,0.02));}
  h1{margin:0 0 6px 0;font-size:1.4rem}
  p.lead{margin:0 0 14px 0;color:#cfe8ff;opacity:0.9;font-size:0.95rem}

  .wheel{
    height:160px;border-radius:12px;display:flex;align-items:center;justify-content:center;
    font-weight:800;font-size:1.4rem;color:#061425;background:linear-gradient(135deg,#7c3aed,#06b6d4);
    position:relative; overflow:hidden; box-shadow: 0 8px 26px rgba(12,12,20,0.5);
  }
  .controls{display:flex;gap:10px;margin-top:14px;flex-wrap:wrap}
  .btn{
    padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:700;
    background:transparent;color:inherit;transition:transform .12s ease, box-shadow .12s;
  }
  .btn.primary{background:var(--accent); color:#052041; box-shadow:0 8px 20px rgba(0,0,0,0.25);}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);}

  .right{padding:16px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));}
  .list{display:flex;flex-direction:column;gap:8px}
  .option{
    display:flex;align-items:center;justify-content:space-between;padding:10px;border-radius:8px;
    background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.03);
  }
  .option .leftside{display:flex;gap:8px;align-items:center;}
  .option input[type="text"]{background:transparent;border:0;color:inherit;font-weight:700;width:140px}
  .option input[type="checkbox"]{transform:scale(1.15);}

  .history{margin-top:12px;max-height:220px;overflow:auto;padding:8px;border-radius:8px;background:rgba(2,6,23,0.45)}
  .history li{padding:6px 8px;border-bottom:1px dashed rgba(255,255,255,0.03);font-size:0.95rem}

  footer.note{grid-column:1/3;margin-top:10px;text-align:center;color:rgba(255,255,255,0.65);font-size:0.9rem}

  @media (max-width:880px){ .app{grid-template-columns:1fr} .right{order:-1} .wheel{height:140px} }
</style>
</head>
<body>
  <main class="app" role="main">
    <section class="left" aria-labelledby="title">
      <h1 id="title">éšæœºæŠ½ç­¾å™¨</h1>
      <p class="lead">ç‚¹å‡»â€œæŠ½ç­¾â€æ¥é€‰æ‹©ä¸€ä¸ªéƒ¨é—¨ã€‚å¯ç¼–è¾‘é€‰é¡¹ã€è®°å½•å†å²ã€æ”¯æŒæŒ‰ Enter è§¦å‘ã€‚</p>

      <div class="wheel" id="wheel" aria-live="polite">ç®—æ³•ç»„ Â· è½¯ä»¶ç»„ Â· åµŒå…¥å¼ç»„ Â· å®£ä¼ éƒ¨ Â· ç»„ç»‡éƒ¨</div>

      <div class="controls" style="margin-top:14px">
        <button class="btn primary" id="drawBtn" title="æŠ½ç­¾ï¼ˆEnterï¼‰">æŠ½ç­¾ ğŸ²</button>
        <button class="btn ghost" id="drawMultipleBtn" title="ä¸€æ¬¡æŠ½å–å¤šå">æŠ½å– 3 å</button>
        <button class="btn ghost" id="shuffleBtn" title="æ‰“ä¹±é€‰é¡¹æ˜¾ç¤º">æ‰“ä¹±</button>
        <button class="btn ghost" id="resetBtn" title="æ¸…ç©ºå†å²å¹¶å¤ä½">é‡ç½®</button>
        <button class="btn ghost" id="copyBtn" title="å¤åˆ¶æœ€è¿‘ä¸€æ¬¡ç»“æœ">å¤åˆ¶</button>
      </div>

      <div style="margin-top:12px;color:rgba(255,255,255,0.75);font-size:0.95rem">
        å¿«æ·é”®ï¼šæŒ‰ <kbd>Enter</kbd> æŠ½ç­¾ï¼ŒæŒ‰ <kbd>R</kbd> é‡ç½®ã€‚
      </div>
    </section>

    <aside class="right" aria-labelledby="opts">
      <h3 id="opts" style="margin:0 0 10px 0">æŠ½ç­¾é€‰é¡¹ï¼ˆå¯ç¼–è¾‘/å¤šé€‰å¯ç”¨ï¼‰</h3>

      <div class="list" id="optionList">
        <div class="option"><div class="leftside"><input type="checkbox" data-name="ç®—æ³•ç»„" checked><input type="text" value="ç®—æ³•ç»„" data-name="ç®—æ³•ç»„"></div><div class="rightside"><button class="btn" data-action="delete">åˆ é™¤</button></div></div>
        <div class="option"><div class="leftside"><input type="checkbox" data-name="è½¯ä»¶ç»„" checked><input type="text" value="è½¯ä»¶ç»„" data-name="è½¯ä»¶ç»„"></div><div class="rightside"><button class="btn" data-action="delete">åˆ é™¤</button></div></div>
        <div class="option"><div class="leftside"><input type="checkbox" data-name="åµŒå…¥å¼ç»„" checked><input type="text" value="åµŒå…¥å¼ç»„" data-name="åµŒå…¥å¼ç»„"></div><div class="rightside"><button class="btn" data-action="delete">åˆ é™¤</button></div></div>
        <div class="option"><div class="leftside"><input type="checkbox" data-name="å®£ä¼ éƒ¨" checked><input type="text" value="å®£ä¼ éƒ¨" data-name="å®£ä¼ éƒ¨"></div><div class="rightside"><button class="btn" data-action="delete">åˆ é™¤</button></div></div>
        <div class="option"><div class="leftside"><input type="checkbox" data-name="ç»„ç»‡éƒ¨" checked><input type="text" value="ç»„ç»‡éƒ¨" data-name="ç»„ç»‡éƒ¨"></div><div class="rightside"><button class="btn" data-action="delete">åˆ é™¤</button></div></div>
      </div>

      <div style="margin-top:10px;display:flex;gap:8px">
        <button id="addOption" class="btn">æ·»åŠ é€‰é¡¹</button>
        <button id="exportBtn" class="btn">å¯¼å‡ºå†å²</button>
      </div>

      <h4 style="margin-top:12px;margin-bottom:6px">å†å²</h4>
      <ul class="history" id="history" aria-live="polite"></ul>
    </aside>
  </main>

<script>
/* ç®€æ´ä½†å®Œæ•´çš„å‰ç«¯é€»è¾‘ï¼ˆæ— å¤–éƒ¨ä¾èµ–ï¼‰ */
const wheel = document.getElementById('wheel');
const drawBtn = document.getElementById('drawBtn');
const drawMultipleBtn = document.getElementById('drawMultipleBtn');
const shuffleBtn = document.getElementById('shuffleBtn');
const resetBtn = document.getElementById('resetBtn');
const copyBtn = document.getElementById('copyBtn');
const optionList = document.getElementById('optionList');
const addOptionBtn = document.getElementById('addOption');
const historyEl = document.getElementById('history');
const exportBtn = document.getElementById('exportBtn');

function getOptions(){
  return Array.from(optionList.querySelectorAll('.option')).map(opt=>{
    const txt = opt.querySelector('input[type="text"]').value.trim();
    const enabled = opt.querySelector('input[type="checkbox"]').checked;
    return {name: txt || 'æœªå‘½å', enabled};
  }).filter(o=>o.enabled);
}

function sleep(ms){return new Promise(r=>setTimeout(r,ms));}

async function animatePick(names, times=28){
  for(let i=0;i<times;i++){
    const pick = names[Math.floor(Math.random()*names.length)];
    wheel.textContent = pick;
    await sleep(40 + i*8);
  }
}
function pushHistory(item){
  const li = document.createElement('li');
  const now = new Date().toLocaleString();
  li.textContent = `${now} â€” ${item}`;
  historyEl.prepend(li);
}
drawBtn.addEventListener('click', async ()=>{
  const opts = getOptions();
  if(opts.length===0){ wheel.textContent='è¯·è‡³å°‘å¯ç”¨ä¸€ä¸ªé€‰é¡¹'; return; }
  const names = opts.map(o=>o.name);
  drawBtn.disabled = true;
  await animatePick(names);
  const result = names[Math.floor(Math.random()*names.length)];
  wheel.textContent = `æŠ½ä¸­ï¼š${result} ğŸ‰`;
  pushHistory(result);
  drawBtn.disabled = false;
});

// æŠ½å–å¤šåï¼ˆé»˜è®¤ä¸º 3ï¼‰
drawMultipleBtn.addEventListener('click', async ()=>{
  const opts = getOptions();
  if(opts.length===0){ wheel.textContent='è¯·è‡³å°‘å¯ç”¨ä¸€ä¸ªé€‰é¡¹'; return; }
  const names = opts.map(o=>o.name);
  const k = Math.min(3, names.length);
  drawMultipleBtn.disabled = true;
  await animatePick(names, 36);
  // éšæœºæŠ½ k åï¼Œä¸é‡å¤
  const pool = names.slice();
  const picks = [];
  for(let i=0;i<k;i++){
    const idx = Math.floor(Math.random()*pool.length);
    picks.push(pool.splice(idx,1)[0]);
  }
  wheel.textContent = `æŠ½ä¸­ï¼š${picks.join('ï¼Œ')} ğŸ‰`;
  pushHistory(picks.join('ï¼Œ'));
  drawMultipleBtn.disabled = false;
});

shuffleBtn.addEventListener('click', ()=>{
  const nodes = Array.from(optionList.children);
  for(let i=nodes.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    optionList.appendChild(nodes[j]);
    nodes.splice(j,1);
  }
});

resetBtn.addEventListener('click', ()=>{
  historyEl.innerHTML = '';
  wheel.textContent = 'ç®—æ³•ç»„ Â· è½¯ä»¶ç»„ Â· åµŒå…¥å¼ç»„ Â· å®£ä¼ éƒ¨ Â· ç»„ç»‡éƒ¨';
});

copyBtn.addEventListener('click', async ()=>{
  const first = historyEl.querySelector('li');
  if(!first){ wheel.textContent='æ— å†å²å¯å¤åˆ¶'; return; }
  try{
    await navigator.clipboard.writeText(first.textContent);
    wheel.textContent='å·²å¤åˆ¶æœ€è¿‘ç»“æœ';
    setTimeout(()=>wheel.textContent='ç‚¹å‡»â€œæŠ½ç­¾â€å¼€å§‹',1000);
  }catch(e){
    wheel.textContent='å¤åˆ¶å¤±è´¥ï¼ˆæµè§ˆå™¨é™åˆ¶ï¼‰';
  }
});

// option list æ“ä½œï¼šåˆ é™¤ / ç¼–è¾‘ / æ·»åŠ 
optionList.addEventListener('click', e=>{
  const btn = e.target.closest('button');
  if(!btn) return;
  const action = btn.dataset.action;
  if(action === 'delete'){
    const opt = btn.closest('.option');
    opt.parentNode.removeChild(opt);
  }
});

addOptionBtn.addEventListener('click', ()=>{
  const div = document.createElement('div');
  div.className = 'option';
  div.innerHTML = `<div class="leftside"><input type="checkbox" data-name="" checked><input type="text" value="æ–°é€‰é¡¹" data-name=""></div><div class="rightside"><button class="btn" data-action="delete">åˆ é™¤</button></div>`;
  optionList.appendChild(div);
  // focus newly added text
  div.querySelector('input[type="text"]').focus();
});

// å¯¼å‡ºå†å²ä¸ºç®€å• CSV
exportBtn.addEventListener('click', ()=>{
  const items = Array.from(historyEl.querySelectorAll('li')).map(li=>li.textContent);
  if(items.length===0){ wheel.textContent='æ— å†å²å¯å¯¼å‡º'; return; }
  const csv = items.join('\\n');
  const blob = new Blob([csv], {type:'text/plain;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'æŠ½ç­¾å†å².txt'; document.body.appendChild(a); a.click();
  a.remove(); URL.revokeObjectURL(url);
});

// keyboard shortcuts
document.addEventListener('keydown', e=>{
  if(e.key === 'Enter') drawBtn.click();
  if(e.key.toLowerCase() === 'r') resetBtn.click();
});

// initialize accessible attributes for existing inputs (keeps data-name)
document.querySelectorAll('.option input[type="text"]').forEach(inp=>{
  inp.addEventListener('input', ()=>{ inp.dataset.name = inp.value; });
});
document.querySelectorAll('.option input[type="checkbox"]').forEach(cb=>{
  cb.addEventListener('change', ()=>{ cb.dataset.name = cb.nextElementSibling?.value || ''; });
});
</script>
</body>
</html>
